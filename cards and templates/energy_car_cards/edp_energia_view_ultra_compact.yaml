title: EDP Energia
path: edp
icon: mdi:flash
type: custom:grid-layout
layout:
  grid-template-columns: repeat(auto-fill, minmax(min(100%, 120px), 1fr))
  grid-gap: 6px
  padding: 6px
cards:
  # ============================================
  # MAIN STATUS - All in one row on desktop
  # ============================================

  # Current Power (spans 2 columns)
  - type: custom:button-card
    entity: sensor.w_shelly_todos_juntos
    name: Potência
    icon: mdi:flash
    show_state: true
    state_display: |
      [[[
        return Math.round(entity.state) + "W";
      ]]]
    styles:
      card:
        - height: 50px
        - background: |
            [[[
              var p = parseFloat(entity.state);
              if (p > 5000) return "var(--red)";
              if (p > 2000) return "var(--yellow)";
              if (p > 500) return "var(--blue)";
              return "var(--green)";
            ]]]
        - border-radius: 16px
        - padding: 6px
      grid:
        - grid-template-areas: '"i s" "i n"'
        - grid-template-columns: 24px 1fr
      icon:
        - width: 24px
        - color: var(--black)
      name:
        - font-size: 9px
        - opacity: 0.7
        - color: var(--black)
        - justify-self: start
        - padding-left: 4px
      state:
        - font-size: 18px
        - font-weight: 600
        - color: var(--black)
        - justify-self: start
        - padding-left: 4px
    view_layout:
      grid-column: span 2

  # Period
  - type: custom:button-card
    entity: sensor.edp_periodo_atual
    icon: |
      [[[
        return entity.state == "daily" ? "mdi:white-balance-sunny" : "mdi:weather-night";
      ]]]
    show_name: false
    show_state: true
    state_display: |
      [[[
        return entity.state == "daily" ? "Dia" : "Noite";
      ]]]
    styles:
      card:
        - height: 50px
        - background: |
            [[[
              return entity.state == "daily" ? "var(--yellow)" : "var(--blue)";
            ]]]
        - border-radius: 16px
        - padding: 6px
      grid:
        - grid-template-areas: '"i" "s"'
        - grid-template-rows: 1fr auto
      icon:
        - width: 22px
        - color: var(--black)
      state:
        - font-size: 11px
        - font-weight: 600
        - color: var(--black)

  # Today Day
  - type: custom:button-card
    entity: sensor.um_diario_daily
    icon: mdi:white-balance-sunny
    show_name: false
    show_state: true
    state_display: |
      [[[
        return parseFloat(entity.state).toFixed(1);
      ]]]
    show_label: true
    label: kWh
    styles:
      card:
        - height: 50px
        - background: var(--yellow)
        - border-radius: 16px
        - padding: 6px
      grid:
        - grid-template-areas: '"i" "s" "l"'
        - grid-template-rows: auto auto auto
      icon:
        - width: 18px
        - color: var(--black)
        - margin-bottom: 2px
      state:
        - font-size: 14px
        - font-weight: 600
        - color: var(--black)
        - margin: 0
      label:
        - font-size: 8px
        - color: var(--black)
        - opacity: 0.8
        - margin-top: -2px

  # Today Night
  - type: custom:button-card
    entity: sensor.um_diario_nightly
    icon: mdi:weather-night
    show_name: false
    show_state: true
    state_display: |
      [[[
        return parseFloat(entity.state).toFixed(1);
      ]]]
    show_label: true
    label: kWh
    styles:
      card:
        - height: 50px
        - background: var(--blue)
        - border-radius: 16px
        - padding: 6px
      grid:
        - grid-template-areas: '"i" "s" "l"'
        - grid-template-rows: auto auto auto
      icon:
        - width: 18px
        - color: var(--black)
        - margin-bottom: 2px
      state:
        - font-size: 14px
        - font-weight: 600
        - color: var(--black)
        - margin: 0
      label:
        - font-size: 8px
        - color: var(--black)
        - opacity: 0.8
        - margin-top: -2px

  # Today Cost
  - type: custom:button-card
    entity: sensor.edp_valor_diario_euros
    icon: mdi:currency-eur
    show_name: false
    show_state: true
    state_display: |
      [[[
        return parseFloat(entity.state).toFixed(2);
      ]]]
    show_label: true
    label: Hoje
    styles:
      card:
        - height: 50px
        - background: var(--purple)
        - border-radius: 16px
        - padding: 6px
      grid:
        - grid-template-areas: '"i" "s" "l"'
        - grid-template-rows: auto auto auto
      icon:
        - width: 18px
        - color: var(--black)
        - margin-bottom: 2px
      state:
        - font-size: 14px
        - font-weight: 600
        - color: var(--black)
        - margin: 0
      label:
        - font-size: 8px
        - color: var(--black)
        - opacity: 0.8
        - margin-top: -2px

  # ============================================
  # CHART (Ultra compact)
  # ============================================
  - type: custom:apexcharts-card
    header:
      show: false
    graph_span: 15d
    span:
      start: day
      offset: "-14d"
    stacked: true
    apex_config:
      chart:
        height: 150
        toolbar:
          show: false
      plotOptions:
        bar:
          columnWidth: 85%
      legend:
        show: true
        position: top
        fontSize: 10px
        height: 20
      dataLabels:
        enabled: false
      grid:
        padding:
          top: -10
          bottom: 0
      xaxis:
        type: datetime
        labels:
          format: dd/MM
          style:
            fontSize: 9px
      yaxis:
        labels:
          style:
            fontSize: 9px
    series:
      - entity: sensor.um_diario_daily
        name: Dia
        type: column
        color: "#FFA726"
        group_by:
          func: last
          duration: 1d
      - entity: sensor.um_diario_nightly
        name: Noite
        type: column
        color: "#42A5F5"
        group_by:
          func: last
          duration: 1d
    view_layout:
      grid-column: 1 / -1

  # ============================================
  # POWER MONITORS (Ultra compact - 8 cards)
  # ============================================

  - type: custom:button-card
    entity: sensor.tomada_aquecedor_suite_power
    icon: mdi:radiator
    show_name: false
    show_state: true
    state_display: |
      [[[
        var p = Math.round(entity.state);
        return p > 999 ? (p/1000).toFixed(1) + "kW" : p + "W";
      ]]]
    styles:
      card:
        - height: 45px
        - border-radius: 14px
        - padding: 4px
        - background: |
            [[[
              var p = parseFloat(entity.state);
              if (p > 1500) return "var(--red)";
              if (p > 500) return "var(--yellow)";
              if (p > 10) return "var(--blue)";
              return "var(--contrast2)";
            ]]]
      grid:
        - grid-template-areas: '"i" "s"'
      icon:
        - width: 20px
        - margin-bottom: 2px
        - color: |
            [[[
              return parseFloat(entity.state) > 10 ? "var(--black)" : "var(--contrast20)";
            ]]]
      state:
        - font-size: 13px
        - font-weight: 600
        - color: |
            [[[
              return parseFloat(entity.state) > 10 ? "var(--black)" : "var(--contrast20)";
            ]]]

  - type: custom:button-card
    entity: sensor.tomada_servidor_nas_power
    icon: mdi:server
    show_name: false
    show_state: true
    state_display: |
      [[[
        var p = Math.round(entity.state);
        return p > 999 ? (p/1000).toFixed(1) + "kW" : p + "W";
      ]]]
    styles:
      card:
        - height: 45px
        - border-radius: 14px
        - padding: 4px
        - background: |
            [[[
              var p = parseFloat(entity.state);
              if (p > 200) return "var(--red)";
              if (p > 100) return "var(--yellow)";
              if (p > 10) return "var(--blue)";
              return "var(--contrast2)";
            ]]]
      grid:
        - grid-template-areas: '"i" "s"'
      icon:
        - width: 20px
        - margin-bottom: 2px
        - color: |
            [[[
              return parseFloat(entity.state) > 10 ? "var(--black)" : "var(--contrast20)";
            ]]]
      state:
        - font-size: 13px
        - font-weight: 600
        - color: |
            [[[
              return parseFloat(entity.state) > 10 ? "var(--black)" : "var(--contrast20)";
            ]]]

  - type: custom:button-card
    entity: sensor.tomada_ubiquiti_rede_power
    icon: mdi:router-wireless
    show_name: false
    show_state: true
    state_display: |
      [[[
        var p = Math.round(entity.state);
        return p > 999 ? (p/1000).toFixed(1) + "kW" : p + "W";
      ]]]
    styles:
      card:
        - height: 45px
        - border-radius: 14px
        - padding: 4px
        - background: |
            [[[
              var p = parseFloat(entity.state);
              if (p > 100) return "var(--red)";
              if (p > 50) return "var(--yellow)";
              if (p > 10) return "var(--blue)";
              return "var(--contrast2)";
            ]]]
      grid:
        - grid-template-areas: '"i" "s"'
      icon:
        - width: 20px
        - margin-bottom: 2px
        - color: |
            [[[
              return parseFloat(entity.state) > 10 ? "var(--black)" : "var(--contrast20)";
            ]]]
      state:
        - font-size: 13px
        - font-weight: 600
        - color: |
            [[[
              return parseFloat(entity.state) > 10 ? "var(--black)" : "var(--contrast20)";
            ]]]

  - type: custom:button-card
    entity: sensor.tomada_escritorio_power
    icon: mdi:laptop
    show_name: false
    show_state: true
    state_display: |
      [[[
        var p = Math.round(entity.state);
        return p > 999 ? (p/1000).toFixed(1) + "kW" : p + "W";
      ]]]
    styles:
      card:
        - height: 45px
        - border-radius: 14px
        - padding: 4px
        - background: |
            [[[
              var p = parseFloat(entity.state);
              if (p > 300) return "var(--red)";
              if (p > 150) return "var(--yellow)";
              if (p > 10) return "var(--blue)";
              return "var(--contrast2)";
            ]]]
      grid:
        - grid-template-areas: '"i" "s"'
      icon:
        - width: 20px
        - margin-bottom: 2px
        - color: |
            [[[
              return parseFloat(entity.state) > 10 ? "var(--black)" : "var(--contrast20)";
            ]]]
      state:
        - font-size: 13px
        - font-weight: 600
        - color: |
            [[[
              return parseFloat(entity.state) > 10 ? "var(--black)" : "var(--contrast20)";
            ]]]

  - type: custom:button-card
    entity: sensor.shelly_pro_em_1_em0_power_corrigido
    icon: mdi:toaster-oven
    show_name: false
    show_state: true
    state_display: |
      [[[
        var p = Math.round(entity.state);
        return p > 999 ? (p/1000).toFixed(1) + "kW" : p + "W";
      ]]]
    styles:
      card:
        - height: 45px
        - border-radius: 14px
        - padding: 4px
        - background: |
            [[[
              var p = parseFloat(entity.state);
              if (p > 3000) return "var(--red)";
              if (p > 1000) return "var(--yellow)";
              if (p > 10) return "var(--blue)";
              return "var(--contrast2)";
            ]]]
      grid:
        - grid-template-areas: '"i" "s"'
      icon:
        - width: 20px
        - margin-bottom: 2px
        - color: |
            [[[
              return parseFloat(entity.state) > 10 ? "var(--black)" : "var(--contrast20)";
            ]]]
      state:
        - font-size: 13px
        - font-weight: 600
        - color: |
            [[[
              return parseFloat(entity.state) > 10 ? "var(--black)" : "var(--contrast20)";
            ]]]

  - type: custom:button-card
    entity: sensor.shelly_pro_em_1_em1_power
    icon: mdi:ev-plug-tesla
    show_name: false
    show_state: true
    state_display: |
      [[[
        var p = Math.round(entity.state);
        return p > 999 ? (p/1000).toFixed(1) + "kW" : p + "W";
      ]]]
    styles:
      card:
        - height: 45px
        - border-radius: 14px
        - padding: 4px
        - background: |
            [[[
              var p = parseFloat(entity.state);
              if (p > 5000) return "var(--green)";
              if (p > 1000) return "var(--blue)";
              if (p > 10) return "var(--yellow)";
              return "var(--contrast2)";
            ]]]
      grid:
        - grid-template-areas: '"i" "s"'
      icon:
        - width: 20px
        - margin-bottom: 2px
        - color: |
            [[[
              return parseFloat(entity.state) > 10 ? "var(--black)" : "var(--contrast20)";
            ]]]
      state:
        - font-size: 13px
        - font-weight: 600
        - color: |
            [[[
              return parseFloat(entity.state) > 10 ? "var(--black)" : "var(--contrast20)";
            ]]]

  - type: custom:button-card
    entity: sensor.shellyproem50_08f9e0e7ce0c_em1_power
    icon: mdi:sofa
    show_name: false
    show_state: true
    state_display: |
      [[[
        var p = Math.round(entity.state);
        return p > 999 ? (p/1000).toFixed(1) + "kW" : p + "W";
      ]]]
    styles:
      card:
        - height: 45px
        - border-radius: 14px
        - padding: 4px
        - background: |
            [[[
              var p = parseFloat(entity.state);
              if (p > 2000) return "var(--red)";
              if (p > 500) return "var(--yellow)";
              if (p > 10) return "var(--blue)";
              return "var(--contrast2)";
            ]]]
      grid:
        - grid-template-areas: '"i" "s"'
      icon:
        - width: 20px
        - margin-bottom: 2px
        - color: |
            [[[
              return parseFloat(entity.state) > 10 ? "var(--black)" : "var(--contrast20)";
            ]]]
      state:
        - font-size: 13px
        - font-weight: 600
        - color: |
            [[[
              return parseFloat(entity.state) > 10 ? "var(--black)" : "var(--contrast20)";
            ]]]

  - type: custom:button-card
    entity: sensor.shellyproem50_08f9e0e4f828_em1_power
    icon: mdi:water-boiler
    show_name: false
    show_state: true
    state_display: |
      [[[
        var p = Math.round(entity.state);
        return p > 999 ? (p/1000).toFixed(1) + "kW" : p + "W";
      ]]]
    styles:
      card:
        - height: 45px
        - border-radius: 14px
        - padding: 4px
        - background: |
            [[[
              var p = parseFloat(entity.state);
              if (p > 2000) return "var(--red)";
              if (p > 800) return "var(--yellow)";
              if (p > 10) return "var(--blue)";
              return "var(--contrast2)";
            ]]]
      grid:
        - grid-template-areas: '"i" "s"'
      icon:
        - width: 20px
        - margin-bottom: 2px
        - color: |
            [[[
              return parseFloat(entity.state) > 10 ? "var(--black)" : "var(--contrast20)";
            ]]]
      state:
        - font-size: 13px
        - font-weight: 600
        - color: |
            [[[
              return parseFloat(entity.state) > 10 ? "var(--black)" : "var(--contrast20)";
            ]]]

  # ============================================
  # MONTHLY SUMMARY (Ultra compact)
  # ============================================

  - type: custom:button-card
    entity: sensor.mensal_kwh_daily
    icon: mdi:white-balance-sunny
    show_name: false
    show_state: true
    state_display: |
      [[[
        return Math.round(entity.state);
      ]]]
    show_label: true
    label: kWh
    styles:
      card:
        - height: 45px
        - background: var(--yellow)
        - border-radius: 14px
        - padding: 4px
      grid:
        - grid-template-areas: '"i" "s" "l"'
      icon:
        - width: 18px
        - color: var(--black)
        - margin-bottom: 2px
      state:
        - font-size: 13px
        - font-weight: 600
        - color: var(--black)
      label:
        - font-size: 8px
        - color: var(--black)
        - opacity: 0.8
        - margin-top: -2px

  - type: custom:button-card
    entity: sensor.mensal_kwh_nighly
    icon: mdi:weather-night
    show_name: false
    show_state: true
    state_display: |
      [[[
        return Math.round(entity.state);
      ]]]
    show_label: true
    label: kWh
    styles:
      card:
        - height: 45px
        - background: var(--blue)
        - border-radius: 14px
        - padding: 4px
      grid:
        - grid-template-areas: '"i" "s" "l"'
      icon:
        - width: 18px
        - color: var(--black)
        - margin-bottom: 2px
      state:
        - font-size: 13px
        - font-weight: 600
        - color: var(--black)
      label:
        - font-size: 8px
        - color: var(--black)
        - opacity: 0.8
        - margin-top: -2px

  - type: custom:button-card
    entity: sensor.mensal_kwh_total
    icon: mdi:chart-line
    show_name: false
    show_state: true
    state_display: |
      [[[
        return Math.round(entity.state);
      ]]]
    show_label: true
    label: Total
    styles:
      card:
        - height: 45px
        - background: var(--contrast2)
        - border-radius: 14px
        - padding: 4px
      grid:
        - grid-template-areas: '"i" "s" "l"'
      icon:
        - width: 18px
        - margin-bottom: 2px
      state:
        - font-size: 13px
        - font-weight: 600
      label:
        - font-size: 8px
        - opacity: 0.8
        - margin-top: -2px

  - type: custom:button-card
    entity: sensor.edp_valor_mensal_euros
    icon: mdi:currency-eur-off
    show_name: false
    show_state: true
    state_display: |
      [[[
        return parseFloat(entity.state).toFixed(0) + "€";
      ]]]
    show_label: true
    label: Ciclo
    styles:
      card:
        - height: 45px
        - background: var(--purple)
        - border-radius: 14px
        - padding: 4px
      grid:
        - grid-template-areas: '"i" "s" "l"'
      icon:
        - width: 18px
        - color: var(--black)
        - margin-bottom: 2px
      state:
        - font-size: 13px
        - font-weight: 600
        - color: var(--black)
      label:
        - font-size: 8px
        - color: var(--black)
        - opacity: 0.8
        - margin-top: -2px
